<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#FFA500" />
  <link rel="icon" href="cpn-icon-512x512.png" />
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js");
    }
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="CPN – Secured by Bitcoin. Transparent value, live reserves, and blockchain-backed CPN token." />
  <meta property="og:title" content="CPN – Secured by Bitcoin" />
  <meta property="og:image" content="favicon-64-transparent.png" />
  <link rel="icon" href="favicon-64-transparent.png" type="image/png" />
  <title>CPN – Secured by Bitcoin</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #FFA500;
      color: #fff;
      line-height: 1.6;
      padding-bottom: 120px;
    }
    header {
      text-align: center;
      padding: 40px 20px 10px;
    }
    header img {
      max-width: 160px;
    }
    h1 {
      margin-top: 10px;
      font-size: 1.8rem;
      font-weight: 300;
    }
    section {
      padding: 40px 20px;
      border-bottom: 1px solid #fff;
      max-width: 800px;
      margin: 0 auto;
    }
    section h2 {
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    .toggle-content {
      display: none;
      margin-top: 15px;
      font-size: 0.95rem;
    }
    .wallet-btn {
      padding: 10px 18px;
      background: #000;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    #disclaimer {
      text-align: center;
      padding: 20px;
      background-color: #fff;
      color: #000;
      font-size: 0.85rem;
    }
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      text-align: center;
      padding: 20px;
      background-color: #fff;
      color: #000;
      z-index: 1000;
    }
    a { color: #000; }
  </style>
</head>
<body>
  <header>
    <img src="cpn_logo_transparent.png" alt="CPN Logo">
    <h1>CPN – Secured by Bitcoin</h1>
  </header>

  <section>
    <h2>CPN Wallet Tracking</h2>
    <div id="wallet-address">Wallet: 3FJbqwjZjco6G3naKgFSEimT7pJpvz3FAL7vUBgrCxrj</div>
    <div id="wallet-cpn">CPN Wallet Balance: Loading...</div>
  </section>

  <section>
    <h2>Liquidity Pool (Raydium)</h2>
    <p>CPN im LP:</p>
    <div id="lp-cpn">Loading...</div>
  </section>

  <section>
    <h2>Proof of Value</h2>
    <p>Live Bitcoin Reserve:</p>
    <div id="btc-balance">Loading BTC balance...</div>
  </section>

  <section>
    <h2>CPN Supply</h2>
    <p>Live CPN Tokens:</p>
    <div id="cpn-balance">Loading CPN token balance...</div>
  </section>

  <section>
    <h2>CPN Token Address</h2>
    <p>CPN1zkBz7VsTALmPfckM6pULDMeEPJCMUaDobWinkMnc</p>
  </section>

  <div id="disclaimer">
    <strong>Disclaimer:</strong>
    <p><strong>CPN ist kein Finanzprodukt.</strong></p>
  </div>

  <footer>&copy; 2025 CROPOLYNAGO.</footer>

  <script>
    const CPN_MINT = "3FJbqwjZjco6G3naKgFSEimT7pJpvz3FAL7vUBgrCxrj";
    const RAY_AMM_ID = "BRS7tWCALcNBwWJerk5fDCCmmgCBMQQBASo4dMRJUCqs";

    document.querySelectorAll('section h2').forEach(header => {
      header.addEventListener('click', () => {
        const content = header.nextElementSibling;
        content.style.display = content.style.display === 'block' ? 'none' : 'block';
      });
    });

        }

    async function fetchTrackedCPN() {
      const wallet = "3FJbqwjZjco6G3naKgFSEimT7pJpvz3FAL7vUBgrCxrj";
      const body = {
        jsonrpc: "2.0",
        id: 1,
        method: "getTokenAccountsByOwner",
        params: [wallet, { mint: CPN_MINT }, { encoding: "jsonParsed" }]
      };
      try {
        const res = await fetch("https://api.mainnet-beta.solana.com", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });
        const data = await res.json();
        let balance = 0;
        if (data.result && data.result.value.length > 0) {
          const info = data.result.value[0].account.data.parsed.info.tokenAmount;
          balance = info.amount / Math.pow(10, info.decimals);
        }
        document.getElementById("wallet-cpn").innerText = `CPN Wallet Balance: ${balance}`;
      } catch (e) {
        document.getElementById("wallet-cpn").innerText = "Unavailable";
      }
    }

      document.getElementById("wallet-cpn").innerText = `CPN Wallet Balance: ${balance}`;
    }

    async function fetchTrackedCPN();
    fetchRayLP() {
      try {
        const res = await fetch("https://api.raydium.io/v2/sdk/liquidity/mainnet/pools");
        const pools = await res.json();
        const pool = pools.find(p => p.id === RAY_AMM_ID);

        if (!pool) {
          document.getElementById("lp-cpn").innerText = "Pool not found";
          return;
        }

        const amount = pool.baseMint === CPN_MINT ? pool.baseVaultBalance : pool.quoteVaultBalance;
        document.getElementById("lp-cpn").innerText = amount;
      } catch (e) {
        document.getElementById("lp-cpn").innerText = "Error";
      }
    }

    async function fetchBTCBalance() {
      const btcAddress = "bc1qr4dl5wa7kl8yu792dceg9z5knl2gkn220lk7a9";
      try {
        const res = await fetch(`https://api.blockcypher.com/v1/btc/main/addrs/${btcAddress}/balance?nocache=${Date.now()}`);
        const data = await res.json();
        if (data && data.final_balance !== undefined) {
          const btc = data.final_balance / 100000000;
          document.getElementById("btc-balance").innerText = `${btc} BTC`;
        } else {
          document.getElementById("btc-balance").innerText = "Unavailable";
        }
      } catch (e) {
        document.getElementById("btc-balance").innerText = "Unavailable";
      }
    }

    async function fetchSolCPNBalance() {
      const wallet = CPN_MINT;
      const mint = CPN_MINT;
      const body = {
        jsonrpc: "2.0",
        id: 1,
        method: "getTokenAccountsByOwner",
        params: [wallet, { mint: mint }, { encoding: "jsonParsed" }]
      };

      try {
        const res = await fetch("https://api.mainnet-beta.solana.com", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });
        const data = await res.json();
        let balance = 0;
        if (data.result && data.result.value.length > 0) {
          const info = data.result.value[0].account.data.parsed.info.tokenAmount;
          balance = info.amount / Math.pow(10, info.decimals);
        }
        document.getElementById("cpn-balance").innerText = `${balance} CPN`;
      } catch (e) {
        document.getElementById("cpn-balance").innerText = "Unavailable";
      }
    }

    fetchBTCBalance();
    fetchSolCPNBalance();
    fetchRayLP();
  </script>
</body>
</html>
